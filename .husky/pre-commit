#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit hooks..."

# C# Syntax Validation and Formatting
echo "ğŸ“ Validating C# code..."
dotnet format 6degrees.sln --verify-no-changes --verbosity quiet
if [ $? -ne 0 ]; then
  echo "âŒ C# formatting issues detected. Run 'dotnet format 6degrees.sln' to fix."
  exit 1
fi

# C# Build Check
echo "ğŸ”¨ Building C# project..."
dotnet build 6degrees.sln --no-restore --verbosity quiet
if [ $? -ne 0 ]; then
  echo "âŒ C# build failed. Fix compilation errors before committing."
  exit 1
fi

# JavaScript/HTML Linting (if frontend files exist)
if [ -d "wwwroot" ]; then
  echo "âœ¨ Linting JavaScript..."
  npx eslint wwwroot/js/**/*.js --quiet
  if [ $? -ne 0 ]; then
    echo "âŒ JavaScript linting failed. Fix errors before committing."
    exit 1
  fi
fi

# Run Unit Tests
echo "ğŸ§ª Running unit tests..."
dotnet test 6degrees.sln --no-build --verbosity quiet
if [ $? -ne 0 ]; then
  echo "âŒ Unit tests failed. Fix tests before committing."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
